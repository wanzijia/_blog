<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vuex | ZIJIA</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo/logo.jpg">
    <meta name="description" content="子佳的博客">
    
    <link rel="preload" href="/assets/css/0.styles.d3e1b34d.css" as="style"><link rel="preload" href="/assets/js/app.bb29d11c.js" as="script"><link rel="preload" href="/assets/js/2.571a1620.js" as="script"><link rel="preload" href="/assets/js/28.34c15a66.js" as="script"><link rel="prefetch" href="/assets/js/10.0a312df9.js"><link rel="prefetch" href="/assets/js/11.760b0bd6.js"><link rel="prefetch" href="/assets/js/12.dd0497aa.js"><link rel="prefetch" href="/assets/js/13.088063bb.js"><link rel="prefetch" href="/assets/js/14.13d23d82.js"><link rel="prefetch" href="/assets/js/15.71664f81.js"><link rel="prefetch" href="/assets/js/16.1afa945d.js"><link rel="prefetch" href="/assets/js/17.f7721fec.js"><link rel="prefetch" href="/assets/js/18.3ecfe8fa.js"><link rel="prefetch" href="/assets/js/19.5129347e.js"><link rel="prefetch" href="/assets/js/20.cdb26a80.js"><link rel="prefetch" href="/assets/js/21.860c81a0.js"><link rel="prefetch" href="/assets/js/22.b4dda94d.js"><link rel="prefetch" href="/assets/js/23.f2e5cd85.js"><link rel="prefetch" href="/assets/js/24.cbcbaa41.js"><link rel="prefetch" href="/assets/js/25.cf629994.js"><link rel="prefetch" href="/assets/js/26.c4c3a5cf.js"><link rel="prefetch" href="/assets/js/27.e32ee73a.js"><link rel="prefetch" href="/assets/js/3.065fc958.js"><link rel="prefetch" href="/assets/js/4.1338cb60.js"><link rel="prefetch" href="/assets/js/5.c0948713.js"><link rel="prefetch" href="/assets/js/6.31c0c849.js"><link rel="prefetch" href="/assets/js/7.4741cb27.js"><link rel="prefetch" href="/assets/js/8.b55d0628.js"><link rel="prefetch" href="/assets/js/9.121a3a86.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d3e1b34d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ZIJIA</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/promise/" class="nav-link">
  Promise以及事件循环机制
</a></li><li class="dropdown-item"><!----> <a href="/js/program/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/js/program/oop.html" class="nav-link">
  面向对象
</a></li><li class="dropdown-item"><!----> <a href="/js/browser/" class="nav-link">
  浏览器相关
</a></li><li class="dropdown-item"><!----> <a href="/js/apiDoc/" class="nav-link">
  api使用
</a></li></ul></div></div><div class="nav-item"><a href="/module/" class="nav-link">
  模块化
</a></div><div class="nav-item"><a href="/ts/" class="nav-link">
  TypeScript
</a></div><div class="nav-item"><a href="/engineered/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue相关" class="dropdown-title"><span class="title">Vue相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue相关" class="mobile-dropdown-title"><span class="title">Vue相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/vue2/" class="nav-link">
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/vue/vueRouter/" class="nav-link">
  vue-router
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  vuex
</a></li><li class="dropdown-item"><!----> <a href="/vue/principle/" class="nav-link">
  Vue源码解析
</a></li></ul></div></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/performanceOptimization/" class="nav-link">
  性能优化
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题整理
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/promise/" class="nav-link">
  Promise以及事件循环机制
</a></li><li class="dropdown-item"><!----> <a href="/js/program/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/js/program/oop.html" class="nav-link">
  面向对象
</a></li><li class="dropdown-item"><!----> <a href="/js/browser/" class="nav-link">
  浏览器相关
</a></li><li class="dropdown-item"><!----> <a href="/js/apiDoc/" class="nav-link">
  api使用
</a></li></ul></div></div><div class="nav-item"><a href="/module/" class="nav-link">
  模块化
</a></div><div class="nav-item"><a href="/ts/" class="nav-link">
  TypeScript
</a></div><div class="nav-item"><a href="/engineered/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue相关" class="dropdown-title"><span class="title">Vue相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue相关" class="mobile-dropdown-title"><span class="title">Vue相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/vue2/" class="nav-link">
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/vue/vueRouter/" class="nav-link">
  vue-router
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  vuex
</a></li><li class="dropdown-item"><!----> <a href="/vue/principle/" class="nav-link">
  Vue源码解析
</a></li></ul></div></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/performanceOptimization/" class="nav-link">
  性能优化
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题整理
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vue/vuex/" aria-current="page" class="active sidebar-link">vuex</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/vuex/#vuex" class="sidebar-link">vuex</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/vuex/#状态管理" class="sidebar-link">状态管理</a></li><li class="sidebar-sub-header"><a href="/vue/vuex/#vuex的module" class="sidebar-link">vuex的module</a></li><li class="sidebar-sub-header"><a href="/vue/vuex/#mutations无引用负载" class="sidebar-link">mutations无引用负载</a></li><li class="sidebar-sub-header"><a href="/vue/vuex/#组件懒加载" class="sidebar-link">组件懒加载</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="vuex"><a href="#vuex" class="header-anchor">#</a> vuex</h2> <p><a href="https://vuex.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">vuex 官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="状态管理"><a href="#状态管理" class="header-anchor">#</a> 状态管理</h3> <p>打算开发中大型应用，集中式数据管理, 一处修改，多处使用，多个组件依赖于同一状态，来自不同组件的行为需要变更同一状态，生态环境给我们提供了官方插件vuex</p> <p><strong>vuex相关成员</strong></p> <p><code>import Vuex from 'vuex'</code>， Vuex是个对象，相关成员如下</p> <table><thead><tr><th>成员</th> <th>用途</th></tr></thead> <tbody><tr><td>Store</td> <td>类，构造状态管理的<strong>实例</strong></td></tr> <tr><td>mapActions</td> <td>函数，通讯工具</td></tr> <tr><td>mapMutations</td> <td>函数，通讯工具</td></tr> <tr><td>mapGetters</td> <td>函数，通讯工具</td></tr> <tr><td>mapState</td> <td>函数，通讯工具</td></tr></tbody></table> <p>状态管理<strong>实例</strong>相关成员</p> <table><thead><tr><th>成员</th> <th>用途</th></tr></thead> <tbody><tr><td>dispatch</td> <td>实例方法，通讯工具</td></tr> <tr><td>commit</td> <td>实例方法，通讯工具</td></tr> <tr><td>state</td> <td>属性，获取公共数据</td></tr></tbody></table> <p><strong>交互流程图</strong></p> <img src="https://vuex.vuejs.org/flow.png" alt="vuex" style="zoom:50%;"> <p><strong>配置</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// /src/main.js</span>

<span class="token comment">//引入store实例</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./plugins/vuex.js'</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
  store<span class="token comment">//控制vue实例，为vue实例提供一个状态管理实例，管理整个vue公共状态</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/plugins/vuex.js</span>

<span class="token comment">//配置 store</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token punctuation">;</span><span class="token comment">//引入vuex包</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//安装插件到vue</span>

<span class="token keyword">import</span> state <span class="token keyword">from</span> <span class="token string">'../store/state.js'</span>
<span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">'../store/actions.js'</span>
<span class="token keyword">import</span> mutations <span class="token keyword">from</span> <span class="token string">'../store/mutations.js'</span>
<span class="token keyword">import</span> getters <span class="token keyword">from</span> <span class="token string">'../store/getters.js'</span>

<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//配置接受state等选项，值为对象</span>
  state<span class="token punctuation">,</span>mutations<span class="token punctuation">,</span>
  getters<span class="token punctuation">,</span>actions
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span><span class="token comment">//导出store实例给main.js</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/store/state.js</span>

<span class="token keyword">let</span> state<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span><span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> state<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/store/actions</span>

<span class="token keyword">let</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">jia</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>commit<span class="token punctuation">,</span>state<span class="token punctuation">}</span><span class="token punctuation">,</span>payload</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   	<span class="token comment">//state 公共状态 payload 负载  payload有没有传递时，是事件对象</span>
    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> actions<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/store/mutations.js</span>

<span class="token keyword">let</span> mutations<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token function-variable function">increment</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>payload</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//state 仓库|公共数据 payload携带的负载 payload有没有传递时，是undefined</span>
    state<span class="token punctuation">.</span>count<span class="token operator">+=</span>payload<span class="token punctuation">;</span><span class="token comment">//mutations 不做业务,只负责突变state</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> mutations<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/store/getters.js</span>

<span class="token keyword">let</span> getters <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">count</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//返回处理后的state  ~~ computed  </span>
    <span class="token keyword">return</span> state<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token string">'偶数'</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token string">'奇数'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> getters<span class="token punctuation">;</span>
</code></pre></div><p><strong>组件中使用</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!--声明式 发送请求--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>类型(负载)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--展示状态--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{count}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{$store.state.count}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>mapActions<span class="token punctuation">,</span> mapMutations<span class="token punctuation">,</span>mapState<span class="token punctuation">,</span>mapGetters<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./plugins/vuex.js'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function">jia</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//编程式 发送请求</span>
      store <span class="token operator">|</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'类型'</span><span class="token punctuation">,</span>数据<span class="token operator">/</span>负载<span class="token operator">/</span>payload<span class="token punctuation">)</span> <span class="token comment">//-&gt; mutations</span>
			store <span class="token operator">|</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'类型'</span><span class="token punctuation">,</span>数据<span class="token operator">/</span>负载<span class="token operator">/</span>payload<span class="token punctuation">)</span>  <span class="token comment">//-&gt; actions</span>
			store <span class="token operator">|</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>dispatch<span class="token operator">|</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'类型'</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span>负载<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// payload={}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  
  <span class="token comment">//mapActions 用来接管methods,返回一个对象</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">'jia'</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  
  <span class="token comment">//mapMutations 接管methods,跳过actions找mutations</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">'increment'</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  
  <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token comment">//mapMutations 返回来一个对象</span>
      <span class="token string">'increment'</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jia'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//mapActions 返回来一个对象</span>
      
    <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//组件内部methods</span>
      <span class="token operator">...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
  <span class="token comment">//mapGetters接管computed，返回一个对象</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token string">'count'</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  
  <span class="token literal-property property">computed</span><span class="token operator">:</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token string">'count'</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token comment">//mapState返回一个对象</span>
      <span class="token string">'count'</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token string">'count'</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//组件内容计算属性</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> 
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token string">'偶数'</span>	<span class="token operator">:</span> 
      	<span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token string">'奇数'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>vuex融入到项目当中</strong></p> <p><strong>创建types</strong>：收藏vuex提交类型，便于后期修改，和一些types工具检查</p> <p><strong>路由监听</strong>：找一个不会被卸载组件，做数据观测（属性检测 watch），<code>commit</code> 到<code>mutations</code>突变state.nav数据</p> <p><strong>拦截器</strong>：请求和响应前后，<code>commit</code>-&gt;<code>mutations</code>突变state.bLoading</p> <p><strong>main.js获取本地token</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/plugins/router.js</span>

<span class="token comment">//同步localStorage 到 vuex  防止强刷</span>
<span class="token keyword">let</span> local <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>local<span class="token punctuation">)</span><span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'USER'</span><span class="token punctuation">,</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>local<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>拦截器携带到后端校验</strong></p> <p>每次发生请求，都要携带token到后端校验是否过期，拦截器携带从vuex中抓取token ，带在headers，成功返回对应接口的数据， 失败返回未登录的信息，拦截器负责前端路由的跳转</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/plugins/axios.js</span>

<span class="token comment">//axios的封装</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./vuex.js'</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router.js'</span>

<span class="token comment">// 添加一个请求的拦截</span>
axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	
  <span class="token comment">//抓取公共state的token</span>
  <span class="token keyword">let</span> token <span class="token operator">=</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>token<span class="token punctuation">;</span>
  token <span class="token operator">=</span> token <span class="token operator">?</span> token <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
  config<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'token'</span><span class="token operator">:</span> token
  <span class="token punctuation">}</span>
  store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'LOADING'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment">//控制loading显示</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 请求错误时做点事</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//添加一个响应拦截</span>
axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'LOADING'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  
  <span class="token comment">//token过期: 返回值2,当前路由不是login时跳转 </span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>err <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>fullPath<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>fullPath<span class="token comment">// 携带当前路径，便于登录后返回，登录时需要同步vuex和localStorage</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> response<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$axios <span class="token operator">=</span> axios<span class="token punctuation">;</span>
window<span class="token punctuation">.</span>axios <span class="token operator">=</span> axios<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> axios<span class="token punctuation">;</span>

</code></pre></div><h3 id="vuex的module"><a href="#vuex的module" class="header-anchor">#</a> vuex的module</h3> <p>由于使用单一状态树，应用的所有状态会集中到一个比较大的对象。当应用变得非常复杂时，store 对象就有可能变得相当臃肿。</p> <p>为了解决以上问题，Vuex 允许我们将 store 分割成<strong>模块（module）</strong>。每个模块拥有自己的 state、mutation、action、getter</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/plugins/vuex.js</span>
<span class="token keyword">import</span> goods <span class="token keyword">from</span> <span class="token string">'../store/modules/goods.js'</span>
<span class="token keyword">import</span> detail <span class="token keyword">from</span> <span class="token string">'../store/modules/detail.js'</span>

<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>actions<span class="token punctuation">,</span>mutations<span class="token punctuation">,</span>getters<span class="token punctuation">,</span><span class="token comment">//根作用域</span>
  <span class="token literal-property property">modules</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//模块作用域</span>
    goods<span class="token punctuation">,</span>detail
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//src/store/modules/goods.js</span>
<span class="token keyword">const</span> state<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token literal-property property">list</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> actions<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token constant">A_GOODS_LIST</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>dispatch<span class="token punctuation">,</span>commit<span class="token punctuation">,</span>getters<span class="token punctuation">,</span>state<span class="token punctuation">,</span>rootState<span class="token punctuation">,</span>rootGetters<span class="token punctuation">}</span><span class="token punctuation">,</span>payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//state,getters 为模块内部，局部</span>
    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'M_GOODS_LIST'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token comment">//  局部化访问模块内部</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'jia'</span><span class="token punctuation">,</span>payload<span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">root</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//访问根 dispatch 或 commit</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'模块名/类型'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token comment">//模块访问模块</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token constant">GLOBAL_A_JIA</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//模块注册全局 action</span>
    <span class="token literal-property property">root</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>dispatch<span class="token punctuation">,</span>commit<span class="token punctuation">,</span>getters<span class="token punctuation">,</span>state<span class="token punctuation">,</span>rootGetters<span class="token punctuation">,</span>rootState<span class="token punctuation">}</span><span class="token punctuation">,</span>payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token operator">...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mutations<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token constant">M_GOODS_LIST</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>list<span class="token operator">=</span>payload<span class="token punctuation">;</span><span class="token comment">//state是局部</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> getters<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token constant">G_GOODS_LIST</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>getters<span class="token punctuation">,</span>rootState<span class="token punctuation">,</span>rootGetters</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'处理后的'</span><span class="token operator">+</span>state<span class="token punctuation">.</span>list
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  <span class="token literal-property property">namespaced</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//命名空间的模块。模块内部直接调用，外部需要命名空间(见组件)</span>
  state<span class="token punctuation">,</span>actions<span class="token punctuation">,</span>mutations<span class="token punctuation">,</span>getters
<span class="token punctuation">}</span>

</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code>//xx.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>goods请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>A_GOODS_LIST(5)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>发送goods模块下的actions请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>M_GOODS_LIST(5)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>goods模块下的mutations请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    goods模块下的getters属性: {{G_GOODS_LIST}}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    goods模块下的state数据: {{$store.state.goods.list}}/{{list}}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>GLOBAL_A_JIA(3)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>调用模块内部的全局actions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

<span class="token keyword">import</span> <span class="token punctuation">{</span> mapGetters<span class="token punctuation">,</span> mapActions<span class="token punctuation">,</span> mapMutations<span class="token punctuation">,</span> mapState<span class="token punctuation">,</span>createNamespacedHelpers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token comment">//const { mapState, mapActions } = createNamespacedHelpers('模块名')</span>
<span class="token comment">//使用 createNamespacedHelpers 创建基于某个命名空间辅助函数</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jia'</span><span class="token punctuation">,</span> <span class="token string">'jian'</span><span class="token punctuation">,</span> <span class="token string">'odd'</span><span class="token punctuation">,</span> <span class="token string">'yibu'</span><span class="token punctuation">,</span><span class="token string">'GLOBAL_A_JIA'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//GLOBAL_A_JIA定义在模块内的全局actions</span>
    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token string">'goods'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'A_GOODS_LIST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//调用模块，添加了goods的命名空间</span>
    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'increment'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//全局</span>
    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token string">'detail'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'M_DETAIL_LIST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//模块内部</span>
    <span class="token function">show</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'goods/A_GOODS_LIST'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token comment">//调用模块内部</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'goods/M_GOODS_LIST'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token comment">//调用根</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'getCount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//根</span>
    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">'goods'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'G_GOODS_LIST'</span><span class="token punctuation">,</span><span class="token string">'type2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//模块</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//根</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token string">'goods'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//模块</span>
    
    <span class="token comment">//createNamespacedHelpers</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">a</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token comment">//抓取模块内部的state.a作为当前组件的a属性使用</span>
      <span class="token function-variable function">b</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>goods<span class="token punctuation">.</span>b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="mutations无引用负载"><a href="#mutations无引用负载" class="header-anchor">#</a> mutations无引用负载</h3> <p>actions内部要传给mutations的负载(payload),不可以是源state的引用，否则有时会出现非响应式情况，如<strong>购物车</strong></p> <h3 id="组件懒加载"><a href="#组件懒加载" class="header-anchor">#</a> 组件懒加载</h3> <p>让路由配置时所指向的组件，无需一开始就加载到app.js，而是分块到不同的js文件，在路由访问时加载对应组件(js)，减少首屏压力，其原理是利用webpack对代码进行分割，异步调用组件，所以组件懒加载又叫异步路由、分片(块)打包、code splitting、异步组件</p> <p><strong>webpack分片打包支持的语法</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span>目标组件地址<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span>res是加载后的组件<span class="token punctuation">)</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span>组件<span class="token number">1</span><span class="token punctuation">,</span>组件<span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>response<span class="token punctuation">)</span>  response<span class="token operator">=</span>加载结果 需要传入
</code></pre></div><p><strong>vue路由配置</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/plugins/router.js</span>

<span class="token operator">-</span> <span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'xxx'</span>
<span class="token operator">+</span> <span class="token keyword">const</span> <span class="token function-variable function">home</span> <span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;groupname-home&quot; */</span> <span class="token string">&quot;../components/home.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//或者</span>

<span class="token punctuation">{</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span><span class="token string">'/home'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">component</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'../components/home.vue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>r<span class="token punctuation">)</span> <span class="token punctuation">}</span>  <span class="token operator">|</span> home
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><blockquote><p>webpackChunkName: &quot;groupname-home&quot; 给块命名 | 同名会拆到一个块，可减少请求次数</p> <p>在cli2里需要注意</p> <p>​	import() 导入 需要安装 babel-plugin-syntax-dynamic-import</p> <p>​	配置 babelrc  &quot;plugins&quot;: [&quot;syntax-dynamic-import&quot;]</p> <p>组件内部注册异步组件会按照要求到对应的js里面</p> <p>组件内部同步注册组件会打包到app.js</p></blockquote> <p><strong>vue打包后的片名</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//修改片名，需要修改 webpack 配置</span>

<span class="token comment">//vue-cli1 、 2 </span>
<span class="token comment">//src/build/webpack.prod.conf.js</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span>
        <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span><span class="token string">'chunks/[name]-[chunkhash:8].js'</span><span class="token punctuation">,</span><span class="token comment">//build之后的代码更便于识别</span>

<span class="token comment">//vue-cli3 、 4  ***</span>
<span class="token comment">//vue.config.js</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span>
        <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span><span class="token string">'chunks/[name]-[chunkhash:8].js'</span><span class="token punctuation">,</span><span class="token comment">//build之后的代码更便于识别</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.bb29d11c.js" defer></script><script src="/assets/js/2.571a1620.js" defer></script><script src="/assets/js/28.34c15a66.js" defer></script>
  </body>
</html>
